{% extends "base.html" %}

{% macro moeda(v) -%}
  R$ {{ ("{:,.2f}".format((v or 0)|float)).replace(",", "X").replace(".", ",").replace("X", ".") }}
{%- endmacro %}
{% macro numero(v) -%}
  {{ ("{:,.0f}".format((v or 0)|float)).replace(",", ".") }}
{%- endmacro %}

{% set leads_tot = (dados.total_leads or 0)|float %}
{% set leads_meta = (dados.meta_leads or 0)|float %}
{% set perc_leads = (100*leads_tot/leads_meta) if leads_meta else 100 %}
{% set perc_leads_fmt = ("{:,.1f}%".format(perc_leads)).replace(".", ",") %}

{% set inv_total = (dados.investimento_total or 0)|float %}
{% set orc_total = (dados.orcamento_total or 0)|float %}
{% set perc_orc = (100*inv_total/orc_total) if orc_total else 0 %}
{% set perc_orc_fmt = ("{:,.1f}%".format(perc_orc)).replace(".", ",") %}

{% block content %}
<h2>üè† Vis√£o Geral - CHT22</h2>
<p>Resumo executivo do lan√ßamento CHT22 com m√©tricas principais e status atual da campanha.</p>

<div class="metrics-grid">
  <div class="metric-card">
    <div class="metric-value">{{ dados.dias_campanha }} DIAS</div>
    <div class="metric-label">Lan√ßamento Ativo</div>
    <div class="metric-status status-success">{{ dados.data_inicio }} - {{ dados.data_fim }}</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">R$ 15,00</div>
    <div class="metric-label">Meta CPL Capta√ß√£o</div>
    <div class="metric-status status-warning">Atual: {{ dados.cpl_medio_formatado or "R$ 0,00" }}</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">{{ perc_orc_fmt }}</div>
    <div class="metric-label">Or√ßamento Capta√ß√£o</div>
    <div class="metric-status status-info">{{ dados.investimento_total_formatado }} / {{ dados.orcamento_total_formatado }}</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">{{ ("%.2f"|format(dados.roas_geral or 0)).replace(".", ",") }}</div>
    <div class="metric-label">ROAS Geral</div>
    <div class="metric-status status-success">Acima da meta</div>
  </div>
</div>

<h3>üìä Performance Atual vs Meta</h3>
<div class="metrics-grid">
  <div class="metric-card">
    <div class="metric-value">{{ dados.total_leads_formatado }}</div>
    <div class="metric-label">Total de Leads</div>
    <div class="metric-status status-success">Meta: {{ dados.meta_leads_formatado }} ({{ perc_leads_fmt }})</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">{{ numero(dados.conversao.vendas_estimadas) }}</div>
    <div class="metric-label">Vendas Estimadas</div>
    <div class="metric-status status-info">Taxa: {{ dados.conversao.taxa_conversao }}%</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">{{ moeda(dados.conversao.receita_estimada_curso) }}</div>
    <div class="metric-label">Receita Curso</div>
    <div class="metric-status status-success">Ticket: {{ moeda(dados.conversao.ticket_medio_curso) }}</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">{{ moeda(dados.conversao.receita_estimada_mentoria) }}</div>
    <div class="metric-label">Receita Mentoria</div>
    <div class="metric-status status-success">{{ dados.conversao.percentual_mentorias }}% das vendas</div>
  </div>
</div>

<h3>üìà Principais Insights</h3>
<div class="insights-grid">
  <div class="insight-card">
    <h4>üéØ Meta de Leads Superada</h4>
    <p>Capta√ß√£o de {{ dados.total_leads_formatado }} leads superou a meta de
       {{ dados.meta_leads_formatado }} em {{ ("{:,.1f}%".format(perc_leads-100)).replace(".", ",") }}.</p>
  </div>

  <div class="insight-card">
    <h4>üìò Facebook Dominante</h4>
    <p>{{ dados.canais.facebook.percentual or 0 }}% dos leads com ROAS de
       {{ ("%.2f"|format(dados.canais.facebook.roas or 0)).replace(".", ",") }}.
       Canal principal com {{ dados.canais.facebook.leads_formatado or "0" }} leads captados.</p>
  </div>

  <div class="insight-card">
    <h4>üì∫ YouTube Precisa Otimizar</h4>
    <p>CPL de {{ moeda(dados.canais.youtube.cpl) }} e ROAS de
       {{ ("%.2f"|format(dados.canais.youtube.roas or 0)).replace(".", ",") }}.</p>
  </div>

  <div class="insight-card">
    <h4>üì± Instagram Org√¢nico Forte</h4>
    <p>{{ dados.canais.instagram.leads_formatado or "0" }} leads org√¢nicos
       ({{ dados.canais.instagram.percentual or 0 }}%).</p>
  </div>
</div>

<h3>üéØ KPIs e Premissas CHT22</h3>
<p>M√©tricas-chave e premissas baseadas no hist√≥rico para o lan√ßamento</p>

<div class="metrics-grid">
  <div class="metric-card">
    <div class="metric-value">{{ dados.meta_leads_formatado }}</div>
    <div class="metric-label">Meta Capta√ß√£o LEADs</div>
    <div class="metric-status status-success">Atual: {{ dados.total_leads_formatado }} ({{ perc_leads_fmt }})</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">{{ dados.conversao.taxa_conversao }}%</div>
    <div class="metric-label">Taxa de Convers√£o</div>
    <div class="metric-status status-info">Premissa Hist√≥rica</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">{{ moeda(dados.conversao.ticket_medio_curso) }}</div>
    <div class="metric-label">Ticket M√©dio Curso</div>
    <div class="metric-status status-info">Pre√ßo de Venda</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">{{ dados.conversao.percentual_mentorias }}%</div>
    <div class="metric-label">% Vendas Mentorias</div>
    <div class="metric-status status-info">Upsell sobre Curso</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">{{ moeda(dados.conversao.ticket_medio_mentoria) }}</div>
    <div class="metric-label">Ticket M√©dio Mentoria</div>
    <div class="metric-status status-info">Pre√ßo Premium</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">{{ dados.meta_cpl_formatado }}</div>
    <div class="metric-label">Meta CPL Capta√ß√£o</div>
    <div class="metric-status status-warning">Atual: {{ dados.cpl_medio_formatado }}</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">{{ dados.orcamento_total_formatado }}</div>
    <div class="metric-label">Meta Or√ßamento Tr√°fego</div>
    <div class="metric-status status-info">Usado: {{ dados.investimento_total_formatado }} ({{ perc_orc_fmt }})</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">{{ numero(dados.engajamento.seguidores_instagram) }}</div>
    <div class="metric-label">Seguidores Instagram</div>
    <div class="metric-status status-info">Crescimento: +{{ dados.engajamento.taxa_crescimento_instagram }}% m√™s</div>
  </div>

  <div class="metric-card">
    <div class="metric-value">{{ numero(dados.engajamento.seguidores_youtube) }}</div>
    <div class="metric-label">Seguidores YouTube</div>
    <div class="metric-status status-info">Crescimento: +{{ dados.engajamento.taxa_crescimento_youtube }}% m√™s</div>
  </div>
</div>

<h3>‚è∞ Status da Campanha</h3>
<div class="status-grid">
  <div class="status-item"><span class="status-label">Per√≠odo:</span> <span>{{ dados.data_inicio }} a {{ dados.data_fim }}</span></div>
  <div class="status-item"><span class="status-label">Dura√ß√£o:</span> <span>{{ dados.dias_campanha }} dias corridos</span></div>
  <div class="status-item"><span class="status-label">√öltima Atualiza√ß√£o:</span> <span>{{ timestamp }}</span></div>
  <div class="status-item"><span class="status-label">Status:</span> <span class="status-success">Campanha Ativa</span></div>
</div>
{% endblock %}
