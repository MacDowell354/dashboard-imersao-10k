<!-- templates/profissao_canal.html -->
<h2>üë©‚Äç‚öïÔ∏è Profiss√£o x Canal</h2>
<p class="metric-label">Resumo por profiss√£o ‚Äî seguro contra campos ausentes.</p>

{# Pega o dicion√°rio de profiss√µes (ou {} se vier None/ausente) #}
{% set profs = (dados.get('profissoes') or {}) %}

{# Converte para lista de pares (nome, dados) e ordena pelo campo total (se existir) #}
{% set lista = profs.items()|list %}
{% set lista = lista|sort(attribute='1.total', reverse=True) %}

{% if lista and lista|length > 0 %}
  <div class="metrics-grid">
    {# Cards resumidos (top 6) #}
    {% for nome, p in lista[:6] %}
      {% set total = (p.get('total', 0) or 0) %}
      {% set perc  = (p.get('percentual', 0) or 0.0) %}
      <div class="metric-card">
        <div class="metric-value">{{ total|numero_ptbr }}</div>
        <div class="metric-label">{{ nome|replace('_',' ')|title }}</div>
        <div class="metric-status status-info">{{ perc|pct_ptbr }}</div>
      </div>
    {% endfor %}
  </div>

  <h3 style="margin-top:18px">üìã Tabela completa</h3>
  <div class="insight-card">
    <div style="overflow:auto">
      <table style="width:100%;border-collapse:collapse">
        <thead>
          <tr>
            <th style="text-align:left;border-bottom:1px solid var(--bd);padding:8px">Profiss√£o</th>
            <th style="text-align:right;border-bottom:1px solid var(--bd);padding:8px">Leads</th>
            <th style="text-align:right;border-bottom:1px solid var(--bd);padding:8px">% Particip.</th>
          </tr>
        </thead>
        <tbody>
          {% for nome, p in lista %}
            {% set total = (p.get('total', 0) or 0) %}
            {% set perc  = (p.get('percentual', 0) or 0.0) %}
            <tr>
              <td style="padding:8px;border-bottom:1px dashed var(--bd)">{{ nome|replace('_',' ')|title }}</td>
              <td style="padding:8px;border-bottom:1px dashed var(--bd);text-align:right">{{ total|numero_ptbr }}</td>
              <td style="padding:8px;border-bottom:1px dashed var(--bd);text-align:right">{{ perc|pct_ptbr }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% else %}
  <div class="insight-card">
    <p>Nenhum dado de <strong>profiss√µes</strong> informado no contexto.</p>
  </div>
{% endif %}
